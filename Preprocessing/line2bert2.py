#!/usr/bin/env python
'''
NOTE: This uses the alannlp PyTorch implementation of Elmo!
Process a line corpus and convert text to elmo embeddings, save as json array of sentence vectors.
This expects the sents corpus which has fields title, article, domains. and treates
title as the first sentence, then splits the article sentences. The domains are ignored
'''

import argparse
import os
import json
import math
import torch
from transformers import BertTokenizer, BertModel
import readability
import re
import numpy as np
from scipy import stats
import pandas as pd
from collections import Counter

def normalization(df):
    x = np.nan_to_num(stats.zscore(df))
    return x

def extract_readability_features(text):
    text = re.sub(r'\.', '.\n', text)
    text = re.sub(r'\?', '?\n', text)
    text = re.sub(r'!', '!\n', text)
    features = dict(readability.getmeasures(text, lang='en'))
    result = {}
    for d in features:
        result.update(features[d])
    del result['paragraphs']
    result = pd.Series(result)
    return result

def extract_NRC_features(x, sentic_df):
    # tokens = re.sub('[^a-zA-Z]', ' ', x).split()
    tokens = x.split()
    tokens = Counter(tokens)
    df = pd.DataFrame.from_dict(tokens, orient='index', columns=['count'])
    merged_df = pd.merge(df, sentic_df, left_index=True, right_index=True)
    for col in merged_df.columns[1:]:
        merged_df[col] *= merged_df["count"]
    result = merged_df.sum()
    result /= result["count"]
    result = result.iloc[1:]
    return result

configs = {
    "small": "elmo_2x1024_128_2048cnn_1xhighway_options.json",
    "medium": "elmo_2x2048_256_2048cnn_1xhighway_options.json",
    "original5b": "elmo_2x4096_512_2048cnn_2xhighway_5.5B_options.json",
    "original": "elmo_2x4096_512_2048cnn_2xhighway_options.json"
}

models = {
    "small": "elmo_2x1024_128_2048cnn_1xhighway_weights.hdf5",
    "medium": "elmo_2x2048_256_2048cnn_1xhighway_weights.hdf5",
    "original5b": "elmo_2x4096_512_2048cnn_2xhighway_5.5B_weights.hdf5",
    "original": "elmo_2x4096_512_2048cnn_2xhighway_weights.hdf5"

}
n_hl = 12
hidden_dim = 768
MODEL = (BertModel, BertTokenizer, 'bert-base-uncased')
model_class, tokenizer_class, pretrained_weights = MODEL
model = model_class.from_pretrained(pretrained_weights, output_hidden_states=True)  # output_attentions=False
tokenizer = tokenizer_class.from_pretrained(pretrained_weights, do_lower_case=True)
NRC_path1 = "data/NRC-Emotion-Lexicon.xlsx"
NRC_df1 = pd.read_excel(NRC_path1, index_col=0)
NRC_path2 = "data/NRC-VAD-Lexicon.txt"
NRC_df2 = pd.read_csv(NRC_path2, index_col=['Word'], sep='\t')

if torch.cuda.is_available():
    DEVICE = torch.device("cuda")
    print('GPU found (', torch.cuda.get_device_name(torch.cuda.current_device()), ')')
    torch.cuda.set_device(torch.cuda.current_device())
    print('num device avail: ', torch.cuda.device_count())

else:
    DEVICE = torch.device('cpu')
    print('running on cpu')

if __name__ == '__main__':

    default_m = "original"
    parser = argparse.ArgumentParser()
    parser.add_argument("infile", type=str, help="Input file, should be in sent1 format")
    parser.add_argument("outfile", type=str, help="Output file, contains standard cols 0.3, plus json vectors")
    parser.add_argument("-b", type=int, default=50, help="Batchsize (50)")
    parser.add_argument("-l", type=int, default=1000, help="Log every (1000)")
    parser.add_argument("--maxtoks", type=int, default=200, help="Maximum number of tokens per sentence to use (200)")
    parser.add_argument("--maxsents", type=int, default=200,
                        help="Maximum number of sentences per article to use (200)")
    parser.add_argument("-m", type=str, default=default_m,
                        help="Model (small, medium, original, original5b ({})".format(default_m))
    parser.add_argument("-g", action='store_true', help="Use the GPU (default: don't)")
    parser.add_argument("--concat", action='store_true', help="Concatenate representations instead of averaging")
    args = parser.parse_args()

    outfile = args.outfile
    infile = args.infile
    batchsize = args.b
    every = args.l
    # use_gpu = args.g
    # model = os.path.join("elmo", models[args.m])
    config = os.path.join("elmo", configs[args.m])
    concat = args.concat
    maxtoks = args.maxtoks
    maxsents = args.maxsents

    print("Loading model {}...".format(args.m))

    # elmo = ElmoEmbedder(options_file=config, weight_file=model, cuda_device=device)
    # elmo = ElmoTokenEmbedder(options_file=config, weight_file=model)
    token_len = []
    input_id = []
    token_length = 50

    print("Processing lines...")
    with open(infile, "rt", encoding="utf8") as inp:
        nlines = 0
        with open(outfile, "wt", encoding="utf8") as outp:
            for line in inp:
                print('new line')
                fields = line.split("\t")
                title = fields[5]
                tmp = fields[4]
                tmp = tmp.split(" <splt> ")[:maxsents]
                sents = [title]
                sents.extend(tmp)
                # now processes the sents in batches
                outs = []
                # unlike the tensorflow version we can have dynamic batch sizes here!
                print(f'line no:{fields[0]},sents len:{len(sents)}')
                print(math.ceil(len(sents) / batchsize))
                for batchnr in range(math.ceil(len(sents) / batchsize) - 1):
                    print("next batch")
                    avg = []
                    fromidx = batchnr * batchsize
                    toidx = (batchnr + 1) * batchsize
                    actualtoidx = min(len(sents), toidx)
                    # print("Batch: from=",fromidx,"toidx=",toidx,"actualtoidx=",actualtoidx)
                    sentsbat = sents[fromidx:actualtoidx]
                    # print("len of sentsbat:",len(sentsbat))
                    # print("len of sentsbat:",len(sentsbat[0]))
                    sentsbatch = [(" ").join(s.split()[:maxtoks]) for s in sentsbat]
                    # print("len of sentsbatch:",len(sentsbatch))
                    # print("len of sentsbatch:",len(sentsbatch[0]))

                    print('sensbatch len:', len(sentsbatch))
                    for s in sentsbatch:
                        if len(s) == 0:
                            s.append("")  # otherwise we get a shape (3,0,dims) result
                    print("checkpoint0")

                    for sentence in sentsbatch:
                        # q=[]
                        input_id = []
                        print(sentence)
                        tokens = tokenizer.tokenize(sentence)
                        print("checkpoint 0.1")

                        token_len.append(len(tokens))
                        token_ids = tokenizer.encode(tokens, add_special_tokens=True, max_length=token_length,
                                                     pad_to_max_length=True)
                        input_id.append(token_ids)
                        input_ids = torch.from_numpy(np.array(input_id)).long()
                        print("checkpoint 1")
                        # print(input_ids)
                        print("checkpoint 1.1")
                        bert_output = model(input_ids)
                        tmph = []
                        for ii in range(n_hl):
                            tmph.append((bert_output[2][ii + 1].detach().numpy()).mean(axis=1))
                        # hidden_features.append(np.array(tmph))
                        alphaW = np.full([n_hl], 1 / n_hl)
                        hidden_features = np.einsum('k,kij->ij', alphaW, tmph)
                        read = extract_readability_features(sentence)
                        read_feat = normalization(read)
                        hidden_features[0].extend(read_feat)
                        emotion = extract_NRC_features(sentence, NRC_df1)
                        hidden_features[0].extend(list(emotion))
                        vad = extract_NRC_features(sentence, NRC_df2)
                        hidden_features[0].extend(list(vad))

                        print(len(hidden_features), len(hidden_features[0]))
                        print("checkpoint 2")

                        avg.append(hidden_features[0])
                    print("checkpoint3")
                    outs.extend(avg)
                    print(len(outs))

                # print("Result lines:", len(outs))
                outs = [a.tolist() for a in outs]
                if not outs:
                    print('empty')

                    # outs=[-0.02828037366271019, -0.02817110197308163, -0.02776097149277727, -0.028012847527861595, -0.028245604364201427, -0.02613477672760685, -0.027191620552912354, -0.026653081954767305, -0.027391517146800954, -0.027306203187132876]
                print(fields[0], fields[1], fields[2], fields[3], json.dumps(outs), sep="\t", file=outp)
                nlines += 1
                if nlines % every == 0:
                    print("Processed lines:", nlines)
    print("Total processed lines:", nlines)

outs = [[0.12239226962750155, -0.5418528666098913, 0.7034134324640036, -0.4117660721143087,
                             0.6081231907010078, -0.06176205778804917, 0.49905205580095446, 0.02061787814212342,
                             0.22285241354256866, -0.08741020653784895, 0.225320139589409, 0.3150200940047701,
                             0.14999023436879116, 0.26116424756279843, -0.27638252122172463, 0.5707838246598839,
                             -0.2521533273781339, -0.12446780999501544, -0.3348126439377665, 0.8826087402800717,
                             0.3728093632186452, 0.13310425837213793, 0.7259378830591838, 0.28675378773671883,
                             0.5138271364072958, 1.0606635436415672, 0.16870621894486246, -0.21265387884341183,
                             -0.1848640628159046, 0.600492250174284, -0.13652245164848864, 0.4923844433700045,
                             0.8695902725060781, -0.2439791777481635, -0.6012902905543644, -0.4174612118707348,
                             -0.29647536979367334, 0.41252317403753597, 0.5509616415171573, 0.014343935996294032,
                             -0.5866033857067425, -0.6947356549402077, -0.14465117243040973, 0.3745337647075454,
                             0.21589513282136366, 0.08011233030507961, 0.20762575790286064, 0.43852175508315355,
                             0.5358705023924509, -1.0437501619259515, -1.0142744779586792, -0.15055030949103335,
                             0.29209189489483833, -0.07228977791965008, -0.09752381379560875, 0.1210887406875069,
                             0.427370353291432, -0.45176017160216964, 0.9186097284158071, 0.18171673221513626,
                             -0.2720953676228722, 0.5081019389132658, -0.017715706800421064, 0.1661490184875826,
                             -0.8851493212083975, 0.3655334037030115, -0.18865355352560675, 0.11099327037421365,
                             -0.07275224120045701, -0.19652051649366814, -0.20579378551337862, -0.07803021883592008,
                             0.11382342867242792, -0.09328966649870077, -0.35327304278810817, 0.1309486844111234,
                             -0.20165758828322092, 0.8031521067023277, 0.3355113084738453, 0.2516557250637561,
                             0.7280069564779599, -0.3077217129369577, 0.8141175849984088, 0.1699614810446898,
                             0.45987066378196084, 0.514995555082957, 0.6225732167561849, 0.21501150336310576,
                             -0.14544806877772012, 0.3940244680270552, -0.7049615581830342, -0.0751669235760346,
                             0.6734683488806088, 0.746743381023407, -0.09803130415578681, -0.30799111436742044,
                             -0.47748443266997725, -0.5946627537099024, -0.7935220922032991, -0.792540772507588,
                             -0.6691770876447359, 0.5051303654909134, 0.30488796362866805, -0.5463876814271014,
                             -0.49134073406457895, 0.2115969095999996, -0.010156486493845776, -0.2187437312677502,
                             0.5190217793763925, 0.3433179093990474, -0.4759089378640056, 0.7046457255880036,
                             -0.11703940915564698, -0.5103150295714537, 0.22841312775077915, 0.5213373328248658,
                             -0.3829634281185766, 0.12491384606497982, -0.08044230138572554, -0.5249732291946808,
                             0.25767505913972855, -0.19402460179602102, -0.30003471424182254, 0.6137779665489991,
                             -0.5107258682449659, -0.20494766874859727, -0.052716912624115736, -0.41583963483572,
                             -0.2817336235505839, 0.4538203347474336, -0.32989869204660255, 0.267618493642658,
                             -0.5282232246051232, 0.029678438964765515, -0.8258914227286974, -0.6403255959351857,
                             -0.6266781582186619, 0.2835960074638327, 0.1115874828149875, -0.07140658050775527,
                             -0.928888904551665, 0.6484446463485557, -0.17638498482604825, 0.20429612075289094,
                             0.2923235123356183, -0.6122290131946404, -0.44309310677150887, 0.05388181167654693,
                             -1.0840259498606124, -0.2549221493924657, -0.44620525340239203, 0.6580479134184619,
                             -0.3978860142330329, -0.9419691035485204, -0.3393344531456629, -0.762021318078041,
                             0.8174355030059814, -0.389341247578462, 0.023677359024683636, 0.4296311962728699,
                             0.5191475593795378, 0.13486722689898062, -0.05233996629249303, -0.2840227232760905,
                             -0.07446194160729648, -0.08140425368522604, 0.1381867531066139, 0.6945507874091466,
                             -0.41429981876475114, 0.4624573610005124, -0.5118285516897837, 0.24968711162606871,
                             0.1204923406864206, -0.6717029896875221, -0.21060509824504453, 0.4401270512801906,
                             0.6643659981588522, 0.13653659546010502, 0.5127562172710896, 0.18850797484628856,
                             0.22438579595958186, -0.2093419970818407, -0.47952462360262876, -0.4146741994967063,
                             1.0390286073088646, -0.09286266813675562, -0.7180380548040072, 0.3636844166709731,
                             0.6850602192183335, 0.36849374161101867, -1.3601838499307632, -1.292572304606438,
                             -0.0469650625406454, -0.015450999761621169, -0.41334018080184853, 0.08589090686291456,
                             -0.1960627504934867, -0.10133627926309902, 0.07310195251678427, -0.14539334938550988,
                             -0.14907099399715662, 0.796195531884829, 0.24363547990409035, 0.38783814882238704,
                             -0.4184898147359491, 0.6009293546279272, -0.17103421439727148, 0.035139000664154686,
                             -0.8521691846350828, 0.243539549720784, 0.01164723311861355, 0.011748238156239193,
                             -0.20516312588006255, 0.3426290110995372, 0.8134942017495632, -0.036579058233958975,
                             -0.012367368675768382, -0.20456977118737993, 0.23917347503205136, -0.06842033782353003,
                             -1.208628644545873, 0.00471880349020163, -0.2950974466900031, 0.5571630255629619,
                             -0.7352090453108152, 0.36741285957396025, 0.3458881589273611, -0.011066600534832088,
                             0.5609272150322794, -0.34514711486796534, 0.015301634247104325, -0.4944049797874564,
                             -0.15493635134771463, -0.6206360682845115, -0.18570190606017906, 0.9082316334048905,
                             0.5757975173182787, -0.44741768048455316, 0.12887368196000654, -0.00938564558358243,
                             0.08945417590439314, 0.7787497931470473, 0.39295959534744423, -0.06488267524158194,
                             -0.3274083320672313, -0.24683261926596364, -0.4683413229261835, 0.2482656128510522,
                             -0.25405877130106086, 0.1806914620101452, -0.7631485958894094, 0.3955483517299095,
                             0.5612131204688922, 0.26396964862942696, 0.6417595917979876, -0.07590030948631464,
                             -0.29893035620140535, 0.19303803332149985, 0.015342819116388764, 0.2644337418023497,
                             0.5385049109657606, 0.24148071060578027, 1.4832570627331734, -0.59968597193559,
                             0.27670983349283534, 0.09278284624451771, 0.10986243126293023, -0.08422756753861904,
                             0.5726251490414143, 0.030095030864079796, -1.2048796614011128, -0.14215911800662676,
                             -0.18438510720928508, 0.7873867601156234, -0.20162115129884722, -0.11749879703468954,
                             0.13627908378839493, 0.17325940351778024, 0.14199544931761918, -0.21621661291768154,
                             0.4586324325452248, -0.4688897592326005, -1.0209255491693814, -0.299219757784158,
                             0.10525502512852349, -0.3720110673457384, -0.5314190468440454, -0.7103824069102604,
                             -0.5309381845096746, 0.09286000501985352, 0.12961715646088123, 0.830834640810887,
                             -0.1648298469056802, 0.13838756422046572, 0.7788321028153101, 0.032533085284133755,
                             0.06304357635478176, 0.21170612843707207, 0.42861531448822154, -0.04874124331399799,
                             -1.1257678776358564, -0.1773198476682106, -0.4030835125595331, 0.25410774008681375,
                             -0.021725181490182873, 0.43441715774436784, -0.2021561230843266, -0.4669543687875071,
                             -6.217117885748546, -0.11793898674659431, -0.3565474590286612, -0.14950125478208068,
                             -0.3363866911580165, -0.11234031229590377, 0.10575344359191756, -0.04742121354987226,
                             -0.4387282263487577, 0.5523466592033704, 0.42447763060530025, 0.06207020949417103,
                             -0.7971584672729175, -0.5257504973560572, -0.2782460561332603, -0.34703457138190663,
                             0.8134158086031675, -0.388142670194308, -0.5504074382285277, 0.4480143959323565,
                             -0.3678549621254205, -0.4692544049272935, 0.6302328656117121, 0.014452131620297824,
                             0.2259110535184542, 0.176864931670328, 0.4271847456693649, 0.21481777510295313,
                             0.02967845151821772, -1.2163129597902296, -0.5070307366549968, -0.3853991205493609,
                             0.6192819848656654, 0.8580948300659655, 0.1652376041747629, -0.4685113445545236,
                             0.05133272862682739, -0.012110402341932044, -0.2955499095842242, -0.4618572394053141,
                             -0.01940543639163176, -0.6033956160147984, -0.3168941891441743, -0.07854559334615865,
                             0.09262800748304774, -0.43905929258714116, -0.032933358413477734, 0.1023326820383469,
                             0.09633830216868468, 0.24749500576096273, -0.3691880622257789, 0.44756142422556877,
                             -0.08588165099111696, -0.39873307198286057, -0.36557216166208184, 0.6371460144097606,
                             -0.4896902653078238, 0.06901126122102141, -0.5780341710002782, 0.4510663126905759,
                             0.7058880763749281, -0.012907196767628203, -0.12387156300246716, 0.4755816118170817,
                             0.10842496311912933, 0.31646159415443736, -0.3398355201352387, -1.0294834226369858,
                             -0.38477791969974834, -0.023841848402904976, -1.0654865962763627, -0.7518859493235747,
                             0.5136554911732674, -0.6979724888224154, 0.532826770717899, -0.4911890861888726,
                             -0.21225178055465224, -1.0642141501108806, 0.7668581406275431, -0.4105313643813133,
                             -0.15480906330049035, 0.02727854942592482, -0.24019385222345593, 0.5639469213783742,
                             0.3517431931880613, -0.04886463232105597, -0.6038933017601569, 0.4863060141603151,
                             -0.6574989209572474, 0.2719084216902653, 0.06724381023862708, -0.940068001548449,
                             0.4160263231024146, -0.7232473467787106, -0.13097768556326628, -0.2238213606178761,
                             0.19662418775260446, 0.18457765566805995, -0.41734856367111195, -0.12630013554977876,
                             0.43442518729716534, -0.6699471871058146, 0.17493324556077516, -0.3484708570564786,
                             -0.6146885237346091, 0.6985544462998707, -0.03770852861149858, 0.13532341395815214,
                             -0.5560743811850746, 0.07325908425506591, 0.18096427689306435, -0.30018531996756787,
                             -0.44289240924020606, 0.2076254613542308, 0.19223639275878668, 0.026150475877026715,
                             -0.04280501375130066, 0.7432898655533791, -0.026148725301027315, -0.001281808440883967,
                             -0.13239765105148155, 0.6873107800881068, 0.008251086498300229, -0.23338065979381403,
                             -1.292084271709124, 0.22027246498813227, 0.05406288305918373, -0.2783215723466128,
                             0.04621616564691067, 0.0779914554829399, -0.0008531828061677481, -0.045671757310628905,
                             -0.4469253818194071, -0.45767564668009675, 0.17221131175756457, 0.0343516959498326,
                             0.27385279163718224, -0.21311704535037276, -0.26916193465391797, -0.27481321742137266,
                             0.3566786001125971, -0.08559870424990854, 0.07884139645223816, 0.05442068850000701,
                             0.5246963971294462, -0.14315173774957657, -0.4576201761762301, -0.261238486195604,
                             -0.020557136430094634, 0.7992420393663148, 0.3306104385604461, -0.6526956728970011,
                             0.633505011598269, 0.32291014088938635, -0.1452141205469767, 1.215717203915119,
                             -0.06859161580602327, 0.436082240814964, -0.07821185328066348, -0.485170000543197,
                             0.19830741112430889, 0.2387490771555652, -0.1365661813567082, -0.7239467587593632,
                             0.368736195222785, 0.420804555217425, -0.38033729419112206, 0.8572496995329857,
                             0.1309116872337957, -0.05974491701150935, 0.03356363127628962, 1.205526515841484,
                             0.13850142201408744, -0.17189508474742374, -0.22867857152596113, 0.31275809556245804,
                             0.8678195774555205, 0.30424248504762846, 0.5958460519711177, -0.3413518412659565,
                             -0.09366604119228819, 0.042207120607296617, -0.800799549712489, 0.6472140041490395,
                             -0.25286102977891767, 0.1389970432501286, -0.5531314710776011, 0.23964990054567656,
                             0.39031670118371636, 0.5581631350020566, -0.4246790744364261, 0.28584945302767056,
                             0.5616740013162295, -0.12512515128279725, 0.5626378630598385, -0.2382213744179656,
                             -0.30935492319986224, -0.09489159720639384, -0.21823923173360527, 0.1407256042584777,
                             -0.7412871072689692, 0.4375227789084116, 0.38318875059485435, -0.4584550174574057,
                             0.45926502098639804, -0.1865179531741887, 0.3809919630487759, -0.10604797131964,
                             0.10280194125759104, 0.2914535778885086, -0.39264728035777813, -0.4041434001798431,
                             0.09751326862412192, 0.07593794213607907, 0.03322068151707452, -0.10822310244354107,
                             0.5483509587744873, -0.11558060968915622, 0.43402906320989126, -0.5997230454037585,
                             -0.0036744991666637244, -0.01651880602973202, -0.010557704993213235, -0.7081697930892309,
                             -0.5176653393233814, -0.016812268955012165, 0.16093281396509457, -0.2391512220104535,
                             -0.4837885198743, 0.5341179507474104, 0.5511993396406373, -1.4862003475427628,
                             -0.044476610608398914, -0.2447347460935513, 0.30160685007770854, 0.002873143414035436,
                             0.5418627423544725, -0.20911984952787552, 0.07900791727782538, -0.04695212592681247,
                             0.3746508420445025, 0.08487163879908621, -0.30301197340789565, -0.08605001866817472,
                             -0.8063286369045575, -0.05086002964526415, 0.29245523642748594, -0.05129937354164819,
                             -0.1617569069688519, 0.4234981709159911, -0.4208672853807608, -0.37067074111352355,
                             0.28975563682615757, -0.4126611091196537, 0.23653547718034434, -1.0916998038689294,
                             0.07378149001548687, 0.13654069959496457, -0.142475430543224, -0.973255633066098,
                             -1.2499482731024425, 0.7377835735678673, -0.34022850745047134, -0.6415884103626013,
                             -0.914625532614688, -0.3041288286137085, 0.3778118832657734, 0.3818979269514481,
                             0.8497410317262013, -0.0675863738482197, 0.19231809178988138, -0.25000604428350925,
                             -0.0630447866472726, -0.5425476556022961, 0.7353682070970535, 0.05694983123491207,
                             0.21701470389962196, -0.3943541878834366, 0.27763457010344905, 0.05707149859517812,
                             -0.21353120232621828, -0.9190135399500527, 0.01855198823614046, -0.16620183922350404,
                             -0.3041044344815115, 0.062140820237497486, 0.34941246833962697, -0.5541746492187182,
                             0.5238702769080797, 0.1811051085436096, -0.6146128127972285, 0.23083552221457163,
                             -0.5005553662776947, 0.43958944307329745, -0.6219788504143556, 0.589731737660865,
                             0.6911649604638418, 0.6935688443481923, 0.6875122388203938, 0.1452342877164483,
                             -0.7577905257542927, 0.30215388055269915, 1.0114506234725316, -0.5774921999933819,
                             0.06110501444588105, 0.2094495076065262, 0.23296378552913666, -0.3526016647617022,
                             -0.36184063057104743, -0.39575074457873904, -0.9424966921408972, 0.14126803974310553,
                             0.13805790183444816, 0.3505878690630197, 0.8615703408916792, -0.10246179594347873,
                             0.01080870042399814, 0.450062391658624, -0.24526269081979984, 0.015580999354521438,
                             0.42996319321294624, -0.026679756119847298, 0.27772644938280183, -0.10960012239714464,
                             0.6697915736585855, -0.229059978077809, 0.06480179455441731, -0.011719823038826387,
                             0.08248392170450339, -0.4027383948365847, 0.2926862901076674, -0.34177155544360477,
                             -0.12715617691477138, 0.0630694842742135, -0.14076773302319148, 0.42260568092266715,
                             0.5604060292243956, -0.16628181266908842, -0.23850928371151284, -0.33091824594885105,
                             -0.144287647989889, 0.12015784562875825, -0.6350512815018494, -0.11881917107772702,
                             -0.4938890598714351, 0.3136906614527106, -0.4969388482471307, -0.47736225649714464,
                             0.2682048031516994, 0.27418121943871177, -0.09016608863021247, -0.665617493291696,
                             0.1669381751756494, 0.3790642855068047, -0.20554116616646448, -0.22062952583655712,
                             -0.32717175657550496, -0.6663027455409368, -0.06272098561748862, 0.5637632900228102,
                             -0.3150399258981148, -0.04892002170284588, 0.17686527625968054, 0.043141558378313974,
                             -0.33962730690836906, -0.17701480326165137, 0.5683729046334823, -0.017586967636210215,
                             0.24037593572090069, -0.5879529913266499, 0.5099249079357833, 0.024220516982798777,
                             -0.36300489415104187, -0.8513891796271006, -0.43400706537067885, 0.018390639064212636,
                             -0.5110348177452883, 0.8461868266264596, -0.25651597262670595, -0.9580388367176056,
                             -0.26402469103535015, 0.56659135222435, -0.2978709861636162, 0.6779222240050633,
                             0.025236324348952625, -0.46461388313521945, -0.35120471194386477, 0.10670539007211723,
                             0.1753126370410124, 0.25512550716909266, 0.07989573385566472, -0.6110251322388648,
                             -0.08111486242463188, 0.48234634179001046, -0.5766287483274936, 1.2062453081210454,
                             -0.10829103606132168, -0.08935834754568835, 1.0039105713367462, -0.030998539490004376,
                             0.2648797162498037, 0.7313598388185103, 0.5140982232987881, 0.7509947468837102,
                             -0.4265365799268086, -0.6473634640375773, 0.16112313823153576, 0.42089954266945523,
                             -0.4781100282367939, -0.1764212325021314, 0.09851266940434772, -0.15288492944091556,
                             0.1478756028227508, -0.21494675516926995, -0.7800873468319575, 0.28398834974116954,
                             0.043350473880612604, -0.17520437963927785, -0.017698499684532496, -0.7708128069837887,
                             -0.2508036172172675, -0.447024378615121, 0.4649228329459826, 0.6573280096054077,
                             -0.9560191879669825, -0.7570359123249849, -0.15071602041522664, 0.19412321217047668,
                             -0.12832720639804995, 0.48672740409771603, -0.9634724160035449, 0.025850273668766018,
                             0.4894440912952025, 0.4997087058921655, -0.3828094328443209, -0.914084494113922,
                             -0.23277530446648598, 0.015281314651171364, -0.06111785707374413, 0.2978867366909981,
                             0.43208742459925503, -0.2129670965174834, -0.66138200648129, -0.5924997006853421,
                             -0.1934279315173626, 0.4513466774175564, -1.1737881662944953, 0.41158614264956367,
                             -0.3104183742155632, -0.36578313757975894, 0.2985246467093627, -0.12667529036601383,
                             -0.18861653616962332, 0.5200801468454302, 0.6392355517794687, 0.03843136438323805,
                             0.05081085208803414, -0.1920779136319955, 0.21912669829907827, -0.4408606994741906],
                            [0.33041396178305144, -0.6410903856158257, 0.5431430892397959, -0.27343284959594405,
                             0.6713712935646374, -0.08410247003970046, 0.45821609782675893, 0.12655986581618586,
                             0.07878259127028285, -0.05022116145119071, 0.08233339991420507, 0.27805415882418555,
                             0.19804618088528514, 0.3862639145615199, -0.3560270440454284, 0.4875714788213372,
                             -0.17191369955738384, -0.05247569689527155, -0.2129866642256578, 0.8138847295582915,
                             0.29381344436357415, 0.20372862399866182, 0.8100766042868296, 0.3251958435866982,
                             0.5682885441929101, 0.9254476527372997, 0.2415005192936708, -0.025759090669453144,
                             -0.300307330985864, 0.35657621733844275, -0.03544347205509742, 0.504444845020771,
                             0.8050468017657597, -0.19244908168911937, -0.48051592847332353, -0.4941059810419877,
                             -0.466923159857591, 0.29719610139727587, 0.6455335635691881, 0.0070921784111609085,
                             -0.38007577508687973, -0.6140764274944862, -0.2033377289772034, 0.45916787907481194,
                             0.3099128603935241, -0.016694625723175704, 0.09267733494440714, 0.3008518585314353,
                             0.7444679488738376, -0.9511711268375316, -1.1691485693057377, -0.10440783148321012,
                             0.3788514795402686, -0.2718905173242092, 0.035106914117932306, 0.16340261325240135,
                             0.40515996764103573, -0.532708641141653, 0.8323476612567902, 0.09562312935789424,
                             -0.3027155001958211, 0.541713535785675, -0.02780057070776818, -0.00737285307453325,
                             -0.8766250771780807, 0.318240974098444, 0.04550724181657037, 0.2869482797492916,
                             -0.25527302113672096, -0.11437345179729162, -0.3368022631232936, 0.07881250232458112,
                             0.09773501862461369, 0.052308136597275734, -0.14478973532095551, 0.042741684708744274,
                             -0.22866904688999057, 0.7487559591730436, 0.29434980840111774, 0.17510609763363996,
                             0.6836962845797341, -0.3731633971134822, 0.8504859060049057, 0.1172906884457916,
                             0.30948944638172776, 0.39209012826904655, 0.5254020765423775, 0.24125516073157388,
                             -0.18356149240086475, 0.33762745714435977, -0.5638748596732814, -0.06053167399174224,
                             0.8502680708964665, 0.5752038434147836, 0.04755201609805226, -0.29067823849618435,
                             -0.4219383794503907, -0.5555998565008243, -0.7888007660706836, -0.7859129793941975,
                             -0.5578844994306564, 0.20843371873100597, 0.27177020628005266, -0.5648899466420213,
                             -0.3955742691953977, 0.17760556817423395, -0.22320461645722386, -0.032274090854722694,
                             0.31391191265235346, 0.4287401127318541, -0.4769356145213048, 0.8350671678781509,
                             -0.21909195386494196, -0.7096831798553466, 0.5209646108560264, 0.3512539751827717,
                             -0.48203175514936447, 0.1316057831669847, 0.09016204353732367, -0.28060902534828835,
                             0.3244538816312949, -0.0848360496262709, -0.26526672812178725, 0.593983909736077,
                             -0.4919462936619917, -0.2125967787578702, -0.09688368625938894, -0.3606786413583904,
                             -0.17966848759291074, 0.49074498688181234, -0.18779247956263134, 0.4489173851907253,
                             -0.3783373851329088, -0.12943046196596697, -0.6087387998898824, -0.6928084890047709,
                             -0.4814012559751669, 0.26432637497782707, -0.0505398743165036, 0.040724825579673045,
                             -0.8954111896455286, 0.5113953004280726, -0.20432332965234917, 0.00487168692052365,
                             0.22576298632581404, -0.6002021386908989, -0.5126080786188443, 0.0609528897330165,
                             -0.9889739956706762, -0.15058596773693958, -0.5860967754075924, 0.4579217409094174,
                             -0.43118985493977857, -0.8613800182938576, -0.12467549996896803, -0.6170645132660866,
                             0.6689215749502183, -0.4900620095431804, -0.04242231603711844, 0.4709479740510384,
                             0.5255913125971953, 0.20210088432456055, -0.010434508401279652, -0.19727823215847212,
                             -0.19735683974189064, 0.11571831752856572, 0.13362610231464106, 0.6793738231062888,
                             -0.44500564349194366, 0.3919375787178675, -0.36156981438398356, 0.27664457793192315,
                             -0.010482686571776876, -0.6113955229520797, -0.3558249694760889, 0.5107601297398408,
                             0.6667274304976065, 0.07933470172186691, 0.4593466185033321, 0.1353658251464367,
                             0.016696128062903902, -0.38049510059257347, -0.470596802731355, -0.5025493080417315,
                             0.9686957697073617, -0.15063777814308799, -0.5780183151364326, 0.23407920977721608,
                             0.5979125450054804, 0.40507430831591285, -1.3176351239283879, -1.2160966321825981,
                             0.16379322678161162, -0.1583517335044841, -0.3918545258541902, 0.08847633256421734,
                             -0.09426048739502826, -0.11594649342199165, 0.13151386938989162, -0.05520989376236684,
                             -0.11621684146424137, 0.79025150090456, 0.25681598236163455, 0.42997083440423006,
                             -0.4636305353293816, 0.5377973864475885, -0.06422859026739994, 0.055923232498268284,
                             -0.7139176490406195, 0.21559193567372859, 0.06553040041277806, 0.0024229485231141213,
                             -0.2754861996509135, 0.24316034962733585, 0.6559314446058124, 0.03859585244208574,
                             -0.039159172525008536, -0.25059613461295766, 0.2789587133253614, -0.19923255778849125,
                             -0.9666332354148227, -0.17086641762095192, -0.16852246162792045, 0.5572894643992186,
                             -0.5933035997052987, 0.3651188177367051, 0.213963550205032, 0.014663604243348047,
                             0.518310665541018, -0.28148834841946757, 0.061838416673708714, -0.4708380637069543,
                             -0.016261775977909558, -0.5451584483186404, -0.18239097766733417, 0.8793108835816382,
                             0.45053718456377584, -0.4405648742492, 0.060722745023667826, -0.09212637894476453,
                             -0.0030305186907450266, 0.8903427043308814, 0.5218536024913192, -0.05990150819222132,
                             -0.17324951756745577, -0.1697662727286418, -0.45592004122833407, 0.26855909110357357,
                             -0.4006043629099925, 0.1528471488660822, -0.6253201812505722, 0.5007393931349119,
                             0.2426333303252856, 0.20588232763111589, 0.5389478964110216, -0.07479420513845979,
                             -0.4200659417547285, 0.43446744268294424, -0.13728302034238973, 0.19152170776699975,
                             0.5249278807702163, 0.1238797546053926, 1.5441538393497467, -0.518005793603758,
                             0.21161990147083998, 0.2013650489971042, 0.2844129068156083, 0.03501866462950905,
                             0.5945637511710326, 0.10137980431318282, -1.1473908772071202, -0.058782417016724736,
                             -0.26079751566673315, 0.8351583828528721, -0.22473531286232173, 0.01571130271380147,
                             0.09383101109415293, 0.10808738076593727, 0.1750884108866254, -0.31259515866016346,
                             0.5923807695508003, -0.4560748680184285, -1.0293124628563721, -0.2558961963901917,
                             0.05632601812249049, -0.23792488306450343, -0.4642651587103803, -0.7390114292502402,
                             -0.5129122169067463, 0.20046835206449032, -0.041054496852060154, 0.7574074283863107,
                             -0.31006554452081525, 0.0068122927332296915, 0.8594233687035739, 0.16595027149499703,
                             0.15976079863806564, 0.1926157921552658, 0.23635518364608285, -0.06644389157493907,
                             -1.0086504152665534, -0.4343467891061058, -0.3241234390685955, 0.32736825570464134,
                             -0.2073270456554989, 0.5850218112270037, -0.10542611933002871, -0.5003085288529594,
                             -5.14381072918574, -0.04822810785844922, -0.32100348904108006, -0.079240328942736,
                             -0.38381364910552895, -0.2970361518673599, -0.015441335582484804, -0.11819731366510196,
                             -0.33054404767851037, 0.4244340049723783, 0.3275551572442054, 0.09268691530451177,
                             -0.5447381515987217, -0.5692516652246317, -0.13690625969320536, -0.39368400163948536,
                             0.7107488677526513, -0.2621614294669901, -0.7090432172020276, 0.48647193113962806,
                             -0.32089208966741956, -0.2763703235735496, 0.35227137058973307, 0.12509782146662474,
                             0.20006561713914073, 0.36933314780859894, 0.44867090135812754, 0.25234141759574413,
                             0.11096361729626852, -1.151727591951688, -0.44839455808202416, -0.37540655707319576,
                             0.4991640796264013, 1.054107416421175, 0.06788159937908247, -0.49458355891207856,
                             0.02638609505568942, -7.794952640928499e-05, -0.21961298150320846, -0.34296152864893276,
                             -0.08697127954413493, -0.5826020151531944, -0.5161156198009847, 0.06917797232745214,
                             0.11126938283753891, -0.4789512045681476, -0.06626662821508944, 0.34770345967262983,
                             0.1748754410073161, 0.16787029833843312, -0.35655959726621705, 0.281770683825016,
                             -0.21600048275043565, -0.41126256963859, -0.43744546423355735, 0.5725044251109163,
                             -0.1607119884962837, 0.10643610823899508, -0.5721187995901952, 0.3244681629973153,
                             0.724662471562624, -0.09554754639975725, -0.21869789840032655, 0.29186285985633725,
                             0.07357862715919813, 0.2849408464971929, -0.447841345022122, -0.9665260116259257,
                             -0.3839387294525901, -0.1732034380547702, -0.8758082278848935, -0.37908514589071274,
                             0.6308043152093886, -0.8053420552362999, 0.5088348953674237, -0.37649713798115647,
                             -0.2216959757109483, -0.9590766703089079, 0.5680292298396428, -0.44955343760860456,
                             -0.31664982562263805, 0.024050594850753736, -0.2151339203119278, 0.5622284536560376,
                             0.22636941561358978, 0.11570621440963197, -0.42634020660383004, 0.3984387591481209,
                             -0.6655467276771864, 0.03628030869488914, 0.09955882948512831, -0.7420984158913294,
                             0.4450965249755729, -0.5733619853854179, -0.26434453840677935, -0.1310655918593208,
                             0.4104478623873243, 0.11500194234152634, -0.4929465521126985, -0.15765127539634705,
                             0.47475626164426404, -0.6097512245178223, 0.30644274440904457, -0.30445678454513353,
                             -0.75848251581192, 0.6531887575984, -0.08344250482817492, 0.2799561334153016,
                             -0.5876224031671881, 0.08819888997823, 0.12431300214181343, -0.23012178274802864,
                             -0.36759788748652983, 0.27474446994407725, 0.38851921322445077, 0.06782717855821829,
                             0.010665767515699073, 0.545658695201079, -0.0032398495823144774, -0.1807543724620094,
                             -0.425477514664332, 0.638305110236009, -0.08782393454263607, -0.3815776299064358,
                             -1.327917193373044, 0.2002159631811082, 0.0043451519062121784, 0.0170210413634777,
                             0.1286388477310538, 0.07666658718759817, -0.20717071617643038, -0.10379596271862584,
                             -0.4468314262727896, -0.3066976284608245, 0.2393138961245616, -0.06104874610900877,
                             0.10670767445117234, -0.11934328915473694, -0.05672032913813989, -0.3314192543427149,
                             0.22118445734182993, -0.16345679728935167, -0.0005181090285380566, 0.008285447955131534,
                             0.6251661044855912, -0.028388985122243533, -0.38292276195716113, -0.23559490777552125,
                             -0.007620799510429299, 0.6791056338697672, 0.1799764366199573, -0.615250946333011,
                             0.6617248731975753, 0.2904139844079813, -0.35793378786183894, 1.1526702269911766,
                             0.06727781270941098, 0.30272138118743896, -0.23956135412057242, -0.4707450655599435,
                             0.209188523547103, 0.14868128423889476, -0.15997921768575907, -0.5287713710343571,
                             0.30777168460190296, 0.26906146761029953, -0.23571831531201803, 0.8693304210901259,
                             0.18723849020898345, -0.12911162277062735, -0.04028352318952481, 1.1566607902447381,
                             0.15551171684637666, -0.16979266113291186, -0.20926914705584443, 0.34174185246229166,
                             0.71739062666893, 0.2857587688292066, 0.5943963155150414, -0.25555059453472495,
                             -0.03033402496172736, 0.010082934129362307, -0.5000691078603267, 0.5785434535937383,
                             -0.28629420305757464, 0.2803790412338761, -0.4412831179797649, 0.053209139655033745,
                             0.3427366203977726, 0.4743337295949459, -0.41668460766474397, 0.24160198774188757,
                             0.5840047653764485, -0.25262587583468604, 0.4649387101332347, -0.4333738796412944,
                             -0.3684805136484404, -0.2542401341876636, -0.3233337433387836, 0.06348431031801738,
                             -0.7621811429659526, 0.568826204786698, 0.12361972142631808, -0.3127528203028002,
                             0.5743799830476443, -0.024685145976642772, 0.29588273664315534, 0.06390192235509554,
                             0.22050187240044272, 0.10680050930629176, -0.43028459395281965, -0.22169544206311306,
                             -0.16772273776587093, 0.18246135891725618, 0.02068426778229574, 0.02132968951506578,
                             0.2908133184537292, 0.07039624825119972, 0.38618297005693114, -0.470179060784479,
                             -0.04461684466029208, 0.00890378622959058, 0.11447231595714887, -0.7574789784848689,
                             -0.5451815960307915, -0.1075242379059394, 0.16629892013346154, -0.3391487201054891,
                             -0.40934095252305264, 0.4593395181000232, 0.5224326699972152, -1.5256263613700864,
                             -0.03844259791852286, -0.38172980708380544, 0.09541692072525618, -0.09007969646093746,
                             0.2550866057475408, -0.4598863530748834, 0.05625236313790081, 0.0520101956402262,
                             0.32126134882370627, 0.20556602627038953, -0.5081550491352876, -0.1602248189349969,
                             -0.8884914045532544, -0.15695757356782752, 0.31357604218646884, -0.03614018034810822,
                             -0.07930281882484753, 0.31304962405314046, -0.4832270654539267, -0.44199061238517356,
                             0.23875161477675036, -0.40337804953257245, 0.2935987705131992, -1.0303825711210568,
                             0.21384829065452018, 0.06261645032403368, -0.36749074965094525, -0.815256764491399,
                             -1.2069480121135712, 0.6616611443459988, -0.18001138418912888, -0.7421355297168095,
                             -0.9408707246184349, -0.3146418812684714, 0.3161102229108413, 0.26886439463123674,
                             0.7709711914261183, -0.12445532965163392, 0.3859551378215353, -0.2658780144217114,
                             -0.13610756366203228, -0.37759376503527164, 0.7817571833729744, -0.14025149308145046,
                             -0.049617711920291185, -0.5049007808168728, 0.32022644920895493, 0.2143711394940813,
                             -0.28351217570404214, -0.9639430393775302, -0.15757259757568437, -0.078618418580542,
                             -0.12242485024034976, -0.05701204606642326, 0.24474776970843473, -0.4359320246924957,
                             0.436759689822793, 0.10132135590538383, -0.5419482141733168, 0.2572994853059451,
                             -0.40642055248220754, 0.5481218335529168, -0.6919682522614797, 0.5949604235708346,
                             0.8213308230042456, 0.69405301908652, 0.5467191450297832, 0.26047504196564353,
                             -0.5584242918218175, 0.2654352020472288, 0.8745599587758381, -0.5952224217665691,
                             -0.028620894066989425, 0.1417496154705683, 0.21895391121506685, -0.3271749125948796,
                             -0.3490332889681061, -0.4080151667197545, -0.8674936244885125, 0.03435484444101647,
                             0.34394059206048644, 0.34653376881033177, 0.9092564533154169, -0.2289309681703647,
                             -0.17980512666205561, 0.48263770993798977, -0.27581222976247466, -0.04289806424640119,
                             0.467338957513372, -0.09672300393382705, 0.4941085937122503, 0.07203327918735643,
                             0.6941891221019126, -0.1999904599506408, 0.07888070167973636, 0.11113516769061485,
                             -0.11346951303615546, -0.4431456811726094, 0.299043900022904, -0.45607353250185645,
                             0.06148487670967977, -0.035773588654895626, -0.03186946113904316, 0.23450363722319406,
                             0.488632292797168, 0.06807493219578951, -0.310850715264678, -0.4285506041099627,
                             -0.3772200780610243, 0.2363284698997934, -0.6777435522526503, -0.12156769575085491,
                             -0.5290257756908734, 0.4242356506486734, -0.4702720139175652, -0.3942135274410248,
                             0.22111170630281166, 0.2415994896000484, -0.12556325271725657, -0.6430196439226469,
                             0.23005623036685088, 0.45179324472943944, -0.07205778003359833, -0.15691986742118993,
                             -0.2620379732300838, -0.5728150891760985, -0.06793993688188493, 0.6447739458332459,
                             -0.15827422558019555, -0.07591832852146274, 0.13386274408549068, 0.09562514241163927,
                             -0.19503583945333958, 0.11788766206397364, 0.5408084926505883, -0.06852778637160857,
                             0.36597407508331037, -0.5106980341176192, 0.47534519930680585, 0.05336679432851573,
                             -0.5556586397190887, -0.6574582407871882, -0.5578988740841547, 0.015021059041221935,
                             -0.5660726117591063, 0.9414267788330714, -0.18753620671729246, -0.8919424961010616,
                             -0.2598757840072115, 0.40620281423131627, -0.19499383245905239, 0.5859200755755106,
                             0.2768247659939031, -0.5762093638380369, -0.20678447155902777, 0.17202280818795163,
                             0.0710013365993897, 0.00035903378739021025, 0.10545078944414854, -0.41139215510338545,
                             0.058303791486347706, 0.3477777702112992, -0.6539981234818697, 1.0461670706669488,
                             -0.16236417756105465, -0.0568725684036811, 0.9753813594579697, -0.006306844142576061,
                             0.470647578438123, 0.47203952539712185, 0.4448612680037816, 0.6816405703624089,
                             -0.3308614579339822, -0.5385555699467659, 0.01858814681569735, 0.46595624027152854,
                             -0.5581288991185526, -0.07101781417926152, 0.011495909226747847, 0.04422297018269696,
                             0.07753279279374208, -0.08852476192017394, -0.6020045205950736, 0.2501286275995274,
                             0.006570011260919269, -0.2722404432327797, -0.12617797187219063, -0.7029052625099818,
                             -0.1283986639852325, -0.4955308067146688, 0.3908220169444879, 0.5693296752870083,
                             -0.9442963550488153, -1.0573572553694246, -0.10297188535332676, 0.08271305759747823,
                             0.11320855530599751, 0.5062235655883948, -0.8682966704169908, 0.053575090210263916,
                             0.5488593572129805, 0.6845192685723305, -0.5957400692471613, -0.7382556349039077,
                             -0.22685644216835496, 0.10166572030478468, -0.14379294059472156, 0.3170663605754574,
                             0.4468228419621785, -0.23878692598858237, -0.8553319945931435, -0.6200306862592697,
                             -0.2833887025093039, 0.5858633642395337, -1.012530821065108, 0.3021394225458304,
                             -0.4411116621146599, -0.34729046498735744, 0.1938562594975034, -0.13544163961584368,
                             -0.26392841587464017, 0.4909337231268485, 0.5491041471250355, -0.006184134011467307,
                             -0.04381382822369537, -0.16961592005100098, 0.2756428464005391, -0.30841073005770636]]